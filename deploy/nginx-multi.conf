# Config Nginx multi-instance pour Contact Mailer
# À déployer sur : /etc/nginx/sites-available/contact-mailer
#
# Chaque instance est déclarée dans un fichier séparé inclus ci-dessous.
# Les fichiers instance sont dans /etc/nginx/contact-mailer-instances/

server {
    listen 80;
    server_name listes.aubaygues.fr;
    return 301 https://$host$request_uri;
}

server {
    listen 443 ssl;
    server_name listes.aubaygues.fr;

    ssl_certificate /etc/letsencrypt/live/listes.aubaygues.fr/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/listes.aubaygues.fr/privkey.pem;

    # Landing page statique
    location / {
        root /opt/contact-mailer/deploy/landing;
        index index.html;
        try_files $uri $uri/ =404;
    }

    # Inclusion des blocs location par instance
    include /etc/nginx/contact-mailer-instances/*.conf;
}
